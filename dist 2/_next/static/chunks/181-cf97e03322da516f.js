"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[181],{1181:function(e,t,r){r.d(t,{l:function(){return o}});var a=r(2141);class n{async authenticateUser(e,t){try{let{data:t,error:r}=await a.O.from("gebruikers").select("*").eq("user_id",e).single();if(r||!t)return null;return t}catch(e){return console.error("Authentication error:",e),null}}async getUserById(e){try{let{data:t,error:r}=await a.O.from("gebruikers").select("*").eq("id",e).single();if(r)return null;return t}catch(e){return console.error("Get user error:",e),null}}async getUserByUserId(e){try{let{data:t,error:r}=await a.O.from("gebruikers").select("*").eq("user_id",e).single();if(r)return null;return t}catch(e){return console.error("Get user by user_id error:",e),null}}async getFilialen(e){try{let t=a.O.from("filialen").select("*");e&&(t=t.eq("district_manager_id",e));let{data:r,error:n}=await t;if(n)return console.error("Get filialen error:",n),[];return r}catch(e){return console.error("Get filialen error:",e),[]}}async getFiliaalById(e){try{let{data:t,error:r}=await a.O.from("filialen").select("*").eq("id",e).single();if(r)return null;return t}catch(e){return console.error("Get filiaal error:",e),null}}async getAudits(e){try{let t=a.O.from("audits").select("\n          *,\n          filialen:filiaal_id (\n            id,\n            naam,\n            locatie,\n            adres,\n            telefoon,\n            email,\n            status\n          ),\n          gebruikers:district_manager_id (\n            id,\n            user_id,\n            naam,\n            rol,\n            telefoon,\n            actief\n          )\n        ");(null==e?void 0:e.filiaalId)&&(t=t.eq("filiaal_id",e.filiaalId)),(null==e?void 0:e.districtManagerId)&&(t=t.eq("district_manager_id",e.districtManagerId)),(null==e?void 0:e.status)&&(t=t.eq("status",e.status)),(null==e?void 0:e.limit)&&(t=t.limit(e.limit)),(null==e?void 0:e.offset)&&(t=t.range(e.offset,e.offset+(e.limit||50)-1));let{data:r,error:n}=await t.order("audit_datum",{ascending:!1});if(n)return console.error("Get audits error:",n),[];return(r||[]).map(e=>({...e,filiaal:e.filialen,district_manager:e.gebruikers}))}catch(e){return console.error("Get audits error:",e),[]}}async getAuditById(e){try{let{data:t,error:r}=await a.O.from("audits").select("\n          *,\n          filialen:filiaal_id (\n            id,\n            naam,\n            locatie,\n            adres,\n            telefoon,\n            email,\n            status\n          ),\n          gebruikers:district_manager_id (\n            id,\n            user_id,\n            naam,\n            rol,\n            telefoon,\n            actief\n          )\n        ").eq("id",e).single();if(r)return null;let n=await this.getAuditResults(e);return{...t,filiaal:t.filialen,district_manager:t.gebruikers,resultaten:n}}catch(e){return console.error("Get audit error:",e),null}}async createAudit(e){try{let{data:t,error:r}=await a.O.from("audits").insert({filiaal_id:e.filiaal_id,district_manager_id:e.district_manager_id,audit_datum:e.audit_datum,status:e.status||"in_progress",totale_score:e.totale_score||0,pass_percentage:e.pass_percentage||0,opmerkingen:e.opmerkingen}).select().single();if(r)throw r;return t}catch(e){throw console.error("Create audit error:",e),e}}async updateAudit(e,t){try{let{data:r,error:n}=await a.O.from("audits").update(t).eq("id",e).select().single();if(n)return null;return r}catch(e){return console.error("Update audit error:",e),null}}async addAuditResults(e,t){try{await a.O.from("audit_resultaten").delete().eq("audit_id",e);let r=t.map(t=>({audit_id:e,checklist_item_id:t.checklist_item_id,resultaat:t.resultaat,score:"ok"===t.resultaat?5:0,opmerkingen:t.opmerkingen||null,foto_urls:t.foto_urls||[],verbeterpunt:t.verbeterpunt||null})),{error:n}=await a.O.from("audit_resultaten").insert(r);if(n)throw n}catch(e){throw console.error("Add audit results error:",e),e}}async getAuditResults(e){try{let{data:t,error:r}=await a.O.from("audit_resultaten").select("\n          *,\n          audit_checklist_items!inner(\n            id,\n            titel,\n            beschrijving,\n            categorie,\n            gewicht\n          )\n        ").eq("audit_id",e);if(r)return console.error("Get audit results error:",r),[];return(t||[]).map(e=>({...e,checklist_item:e.audit_checklist_items}))}catch(e){return console.error("Get audit results error:",e),[]}}async deleteAudit(e){try{let{error:t}=await a.O.from("audit_resultaten").delete().eq("audit_id",e);if(t)return console.error("Delete audit results error:",t),!1;let{error:r}=await a.O.from("acties").delete().eq("audit_id",e);if(r)return console.error("Delete audit actions error:",r),!1;let{error:n}=await a.O.from("audits").delete().eq("id",e);if(n)return console.error("Delete audit error:",n),!1;return!0}catch(e){return console.error("Delete audit error:",e),!1}}async getChecklistItems(){try{let{data:e,error:t}=await a.O.from("audit_checklist_items").select("*").eq("actief",!0).order("volgorde");if(t)return console.error("Get checklist items error:",t),[];return e}catch(e){return console.error("Get checklist items error:",e),[]}}async getActions(e){try{let t=a.O.from("acties").select("\n        *,\n        audits!inner(\n          id,\n          filiaal_id,\n          audit_datum,\n          totale_score,\n          pass_percentage,\n          filialen!inner(\n            id,\n            naam,\n            locatie\n          )\n        ),\n        audit_resultaten!inner(\n          id,\n          checklist_item_id,\n          resultaat,\n          score,\n          opmerkingen,\n          verbeterpunt,\n          audit_checklist_items!inner(\n            id,\n            categorie,\n            titel,\n            beschrijving,\n            gewicht\n          )\n        )\n      ");e&&(t=t.eq("audits.filiaal_id",e));let{data:r,error:n}=await t.order("created_at",{ascending:!1});if(n)return console.error("Get actions error:",n),[];return r||[]}catch(e){return console.error("Get actions error:",e),[]}}async getActionById(e){try{let{data:t,error:r}=await a.O.from("acties").select("\n          *,\n          audits!inner(\n            id,\n            filiaal_id,\n            audit_datum,\n            totale_score,\n            pass_percentage,\n            filialen!inner(\n              id,\n              naam,\n              locatie\n            )\n          ),\n          audit_resultaten!inner(\n            id,\n            checklist_item_id,\n            resultaat,\n            score,\n            opmerkingen,\n            verbeterpunt,\n            audit_checklist_items!inner(\n              id,\n              categorie,\n              titel,\n              beschrijving,\n              gewicht\n            )\n          )\n        ").eq("id",e).single();if(r)return null;return t}catch(e){return console.error("Get action error:",e),null}}async updateActionStatus(e,t,r,n,i){try{let s={status:t,updated_at:new Date().toISOString()};"completed"===t?(s.voltooid_door=r,s.voltooid_op=new Date().toISOString(),n&&(s.actie_onderneem=n),i&&(s.foto_urls=i)):"verified"===t&&(s.geverifieerd_door=r,s.geverifieerd_op=new Date().toISOString());let{error:o}=await a.O.from("acties").update(s).eq("id",e);if(o)return console.error("Update action status error:",o),!1;return!0}catch(e){return console.error("Update action status error:",e),!1}}async updateActionVerification(e,t,r){try{let{error:n}=await a.O.from("acties").update({verificatie_opmerkingen:t,geverifieerd_door:r,geverifieerd_op:new Date().toISOString(),status:"verified",updated_at:new Date().toISOString()}).eq("id",e);if(n)return console.error("Update action verification error:",n),!1;return!0}catch(e){return console.error("Update action verification error:",e),!1}}async createActionsFromAuditResults(e){try{console.log("\uD83D\uDD27 Calling create_actions_from_audit_results for audit:",e);let{data:t,error:r}=await a.O.rpc("create_actions_from_audit_results",{audit_id:e});if(r)return console.error("❌ Create actions from audit results error:",r),!1;return console.log("✅ Actions created successfully:",t),!0}catch(e){return console.error("❌ Create actions from audit results error:",e),!1}}async testDatabaseFunctions(){try{console.log("\uD83D\uDD0D Testing database connection...");let{data:e,error:t}=await a.O.from("audits").select("id, status, audit_datum").limit(5);if(t)return console.error("❌ Error getting audits:",t),{error:"Failed to get audits"};console.log("\uD83D\uDCCB Audits found:",e);let{data:r,error:n}=await a.O.from("acties").select("id, titel, status, urgentie").limit(5);if(n)return console.error("❌ Error getting actions:",n),{error:"Failed to get actions"};console.log("\uD83C\uDFAF Actions found:",r);let i=[];try{let{data:e,error:t}=await a.O.from("information_schema.routines").select("routine_name, routine_type").eq("routine_schema","public").in("routine_name",["create_actions_from_audit_results","determine_action_urgency"]);t?console.log("⚠️ Could not check functions (this is OK):",t.message):(i=e||[],console.log("\uD83D\uDCCB Available functions:",i))}catch(e){console.log("⚠️ Could not check functions (this is OK):",e.message)}return{functions:i,audits:e||[],actions:r||[]}}catch(e){return console.error("❌ Test database functions error:",e),{error:e.message}}}async createTestAction(){try{console.log("\uD83D\uDD27 Creating test action...");let{data:e,error:t}=await a.O.from("acties").insert({titel:"Test Actie - Database Test",beschrijving:"Dit is een test actie om te controleren of de database werkt",urgentie:"medium",status:"pending",deadline:new Date(Date.now()+6048e5).toISOString().split("T")[0]}).select();if(t)return console.error("❌ Error creating test action:",t),!1;return console.log("✅ Test action created:",e),!0}catch(e){return console.error("❌ Create test action error:",e),!1}}async createActionsManually(e){try{console.log("\uD83D\uDD27 Creating actions manually for audit:",e);let{data:n,error:i}=await a.O.from("audit_resultaten").select("\n          id,\n          checklist_item_id,\n          resultaat,\n          score,\n          opmerkingen,\n          verbeterpunt,\n          audit_checklist_items (\n            categorie,\n            titel,\n            beschrijving,\n            gewicht\n          )\n        ").eq("audit_id",e);if(i)return console.error("❌ Error getting audit results:",i),!1;if(console.log("\uD83D\uDCCB Audit results found:",n),!n||0===n.length)return console.log("⚠️ No audit results found for this audit"),!1;let s=0;for(let i of n)if("niet_ok"===i.resultaat||i.score<4){var t,r;let n="low";i.score<=1?n="high":i.score<=2&&(n="medium");let o=new Date;switch(n){case"high":o.setDate(o.getDate()+3);break;case"medium":o.setDate(o.getDate()+7);break;default:o.setDate(o.getDate()+14)}let{error:l}=await a.O.from("acties").insert({audit_id:e,audit_resultaat_id:i.id,titel:"Actie vereist: ".concat((null===(t=i.audit_checklist_items)||void 0===t?void 0:t.titel)||"Onbekend item"),beschrijving:(i.verbeterpunt||(null===(r=i.audit_checklist_items)||void 0===r?void 0:r.beschrijving)||"Actie vereist")+(i.opmerkingen?" Opmerkingen: ".concat(i.opmerkingen):""),urgentie:n,status:"pending",deadline:o.toISOString().split("T")[0]});l?console.error("❌ Error creating action:",l):(s++,console.log("✅ Action created for result ".concat(i.id)))}return console.log("✅ Created ".concat(s," actions for audit ").concat(e)),s>0}catch(e){return console.error("❌ Create actions manually error:",e),!1}}async updateAction(e,t){try{let{data:r,error:n}=await a.O.from("acties").update(t).eq("id",e).select().single();if(n)return null;return r}catch(e){return console.error("Update action error:",e),null}}async getAllUsers(){try{let{data:e,error:t}=await a.O.from("gebruikers").select("*").order("naam");if(t)return console.error("Get all users error:",t),[];return e}catch(e){return console.error("Get all users error:",e),[]}}async createUser(e){try{console.log("Supabase createUser called with:",e);let{data:t,error:r}=await a.O.from("gebruikers").insert({user_id:null,naam:e.naam,rol:e.rol,telefoon:e.telefoon,actief:!0}).select().single();if(r)throw console.error("Supabase createUser error:",r),Error("Database error: ".concat(r.message));return console.log("Supabase createUser success:",t),t}catch(e){throw console.error("Create user error:",e),e}}async deleteUser(e){try{let{error:t}=await a.O.from("gebruikers").delete().eq("id",e);return!t}catch(e){return console.error("Delete user error:",e),!1}}async updateUser(e,t){try{let{data:r,error:n}=await a.O.from("gebruikers").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)return console.error("Update user error:",n),null;return r}catch(e){return console.error("Update user error:",e),null}}async getUserByEmail(e){try{console.log("\uD83D\uDD0D Supabase getUserByEmail called with email:",e);let{data:t,error:r}=await a.O.from("gebruikers").select("*").eq("user_id",e).single();if(console.log("\uD83D\uDD0D Supabase getUserByEmail result:",{data:t,error:r}),r)return console.log("❌ Supabase getUserByEmail error:",r),null;return t}catch(e){return console.error("❌ Get user by email error:",e),null}}async getKPIData(e){try{let t=a.O.from("audits").select("id, totale_score, status, audit_datum, pass_percentage");e&&(t=t.eq("filiaal_id",e));let{data:r,error:n}=await t;if(n)return console.error("Get audits for KPI error:",n),this.getDefaultKPIData();let i=(null==r?void 0:r.length)||0,s=(null==r?void 0:r.filter(e=>"completed"===e.status))||[],o=s.length>0?s.reduce((e,t)=>e+(t.totale_score||0),0)/s.length:0,l=s.length>0?s.filter(e=>(e.pass_percentage||0)>=80).length/s.length*100:0,c=a.O.from("acties").select("id, status, urgentie");e&&(c=c.eq("filiaal_id",e));let{data:u,error:d}=await c,g=u||[];g.filter(e=>"pending"===e.status).length,g.filter(e=>"completed"===e.status).length,g.filter(e=>"critical"===e.urgentie).length;let f=a.O.from("audit_resultaten").select("verbeterpunt, created_at").not("verbeterpunt","is",null).not("verbeterpunt","eq","");e&&(f=a.O.from("audit_resultaten").select("\n            verbeterpunt, \n            created_at,\n            audits!inner(filiaal_id)\n          ").not("verbeterpunt","is",null).not("verbeterpunt","eq","").eq("audits.filiaal_id",e));let{data:m,error:y}=await f,p=new Map;m&&m.forEach(e=>{if(e.verbeterpunt){let t=p.get(e.verbeterpunt);t?(t.count++,e.created_at>t.lastOccurrence&&(t.lastOccurrence=e.created_at)):p.set(e.verbeterpunt,{count:1,lastOccurrence:e.created_at})}});let _=Array.from(p.entries()).map(e=>{let[t,r]=e;return{item:t,frequentie:r.count,laatste_voorkomen:r.lastOccurrence}}).sort((e,t)=>t.frequentie-e.frequentie).slice(0,5);return{totaal_audits:i,gemiddelde_score:o,pass_percentage:l,verbeterpunten:_,trends:[]}}catch(e){return console.error("Get KPI data error:",e),this.getDefaultKPIData()}}getDefaultKPIData(){return{totaal_audits:0,gemiddelde_score:0,pass_percentage:0,verbeterpunten:[],trends:[]}}async uploadFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"uploads",r=arguments.length>2?arguments[2]:void 0;try{let n=e.name.split(".").pop(),i=r||"".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2),".").concat(n),s="audit-photos/".concat(i),{error:o}=await a.O.storage.from(t).upload(s,e);if(o)throw o;let{data:{publicUrl:l}}=a.O.storage.from(t).getPublicUrl(s);return{url:l,filename:i}}catch(e){throw console.error("Upload file error:",e),e}}}let i=new n;class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}async initialize(){this.isInitialized||(this.isInitialized=!0,console.log("ClientDataService initialized"))}async authenticateUser(e,t){try{let r=await i.authenticateUser(e,t);if(r)return console.log("✅ Supabase authentication successful:",r.user_id),r}catch(e){console.log("❌ Supabase auth failed:",e)}return null}async getUserById(e){try{let t=await i.getUserById(e);if(t)return t}catch(e){console.log("❌ Supabase getUserById failed:",e)}return null}async getFilialen(e){try{return await i.getFilialen(e)}catch(e){return console.log("❌ Supabase getFilialen failed:",e),[]}}async getFiliaalById(e){try{return await i.getFiliaalById(e)}catch(e){return console.log("❌ Supabase getFiliaalById failed:",e),null}}async getAudits(e){try{return await i.getAudits(e)}catch(e){return console.log("❌ Supabase getAudits failed:",e),[]}}async getAuditById(e){try{return await i.getAuditById(e)}catch(e){return console.log("❌ Supabase getAuditById failed:",e),null}}async createAudit(e){try{return await i.createAudit(e)}catch(e){throw console.log("❌ Supabase createAudit failed:",e),e}}async updateAudit(e,t){try{return await i.updateAudit(e,t)}catch(e){return console.log("❌ Supabase updateAudit failed:",e),null}}async getChecklistItems(){try{return await i.getChecklistItems()}catch(e){return console.log("❌ Supabase getChecklistItems failed:",e),[]}}async getKPIData(e){try{return await i.getKPIData(e)}catch(e){return console.log("❌ Supabase getKPIData failed:",e),{totaal_audits:0,gemiddelde_score:0,pass_percentage:0,verbeterpunten:[],trends:[]}}}async getActions(e){try{return await i.getActions(e)}catch(e){return console.log("❌ Supabase getActions failed:",e),[]}}async getActionById(e){try{return await i.getActionById(e)}catch(e){return console.log("❌ Supabase getActionById failed:",e),null}}async updateActionStatus(e,t,r,a,n){try{return await i.updateActionStatus(e,t,r,a,n)}catch(e){return console.log("❌ Supabase updateActionStatus failed:",e),!1}}async updateActionVerification(e,t,r){try{return await i.updateActionVerification(e,t,r)}catch(e){return console.log("❌ Supabase updateActionVerification failed:",e),!1}}async createActionsFromAuditResults(e){try{return await i.createActionsFromAuditResults(e)}catch(e){return console.log("❌ Supabase createActionsFromAuditResults failed:",e),!1}}async testDatabaseFunctions(){try{return await i.testDatabaseFunctions()}catch(e){return console.log("❌ Supabase testDatabaseFunctions failed:",e),{error:e.message}}}async createTestAction(){try{return await i.createTestAction()}catch(e){return console.log("❌ Supabase createTestAction failed:",e),!1}}async createActionsManually(e){try{return await i.createActionsManually(e)}catch(e){return console.log("❌ Supabase createActionsManually failed:",e),!1}}async updateAction(e,t){try{return await i.updateAction(e,t)}catch(e){return console.log("❌ Supabase updateAction failed:",e),null}}async getAllUsers(){try{return await i.getAllUsers()}catch(e){return console.log("❌ Supabase getAllUsers failed:",e),[]}}async createUser(e){try{return await i.createUser(e)}catch(e){throw console.log("❌ Supabase createUser failed:",e),e}}async deleteUser(e){try{return await i.deleteUser(e)}catch(e){return console.log("❌ Supabase deleteUser failed:",e),!1}}async updateUser(e,t){try{return await i.updateUser(e,t)}catch(e){return console.log("❌ Supabase updateUser failed:",e),null}}async getUserByEmail(e){try{return await i.getUserByEmail(e)}catch(e){return console.log("❌ Supabase getUserByEmail failed:",e),null}}async addAuditResults(e,t){try{return await i.addAuditResults(e,t)}catch(e){throw console.log("❌ Supabase addAuditResults failed:",e),e}}async getAuditResults(e){try{return await i.getAuditResults(e)}catch(e){return console.log("❌ Supabase getAuditResults failed:",e),[]}}async deleteAudit(e){try{return await i.deleteAudit(e)}catch(e){throw console.log("❌ Supabase deleteAudit failed:",e),e}}async uploadFile(e){try{return await i.uploadFile(e)}catch(e){throw console.log("❌ Supabase uploadFile failed:",e),e}}constructor(){this.isInitialized=!1,this.initialize()}}let o=s.getInstance()},2141:function(e,t,r){r.d(t,{O:function(){return a}});let a=(0,r(3887).eI)("https://kauerobifkgjvddyrkuz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImthdWVyb2JpZmtnanZkZHlya3V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNTIxODQsImV4cCI6MjA3NDcyODE4NH0.GqMYsz9byBYHw_fqmPYH53E4fyciz3MpdUtDQDhpvd8")}}]);