"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{1618:function(e,t,a){a.d(t,{AuthProvider:function(){return l},a:function(){return s}});var i=a(7437),r=a(2265),n=a(9756);let o=(0,r.createContext)(void 0),s=()=>{let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:t}=e,[a,s]=(0,r.useState)(null),[l,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=async()=>{try{if("undefined"==typeof localStorage){console.log("\uD83C\uDF10 Server-side rendering detected, skipping auth check"),d(!1);return}let e=localStorage.getItem("audit_user");if(console.log("\uD83D\uDD0D Checking existing session..."),console.log("\uD83D\uDCE6 Saved user from localStorage:",e),e)try{let t=JSON.parse(e);console.log("\uD83D\uDC64 Parsed user:",t),console.log("\uD83D\uDD04 Using saved user directly (skipping database lookup)"),s(t),console.log("✅ User set from localStorage")}catch(e){console.error("❌ Error parsing localStorage user:",e),localStorage.removeItem("audit_user")}else console.log("\uD83D\uDCED No saved user found in localStorage")}catch(e){console.error("❌ Error in checkExistingSession:",e)}finally{console.log("\uD83C\uDFC1 Setting loading to false"),d(!1)}},t=setTimeout(()=>{console.log("⏰ Auth check timeout, setting loading to false"),d(!1)},3e3);e().finally(()=>{clearTimeout(t)})},[]);let u=async e=>{try{if("undefined"==typeof localStorage)return{success:!1,error:"Server-side rendering not supported"};let t=await n.l.getUserByEmail(e);if(t){let e={id:t.id,user_id:t.email,naam:t.naam,rol:t.rol,telefoon:t.telefoon,actief:t.actief,created_at:t.created_at,updated_at:t.updated_at};if(!e.actief)return{success:!1,error:"Account is gedeactiveerd"};return s(e),localStorage.setItem("audit_user",JSON.stringify(e)),{success:!0}}let a={ADMIN:{id:"00000000-0000-0000-0000-000000000001",user_id:"ADMIN",naam:"Admin User",rol:"admin",telefoon:"+32 123 456 789",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},MAN01:{id:"00000000-0000-0000-0000-000000000002",user_id:"MAN01",naam:"COO Manager",rol:"coo",telefoon:"+32 123 456 790",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},MAN02:{id:"00000000-0000-0000-0000-000000000003",user_id:"MAN02",naam:"District Manager",rol:"district_manager",telefoon:"+32 123 456 791",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},USER1:{id:"00000000-0000-0000-0000-000000000004",user_id:"USER1",naam:"User",rol:"user",telefoon:"+32 123 456 792",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}[e];if(!a)return{success:!1,error:"User ID niet gevonden"};if(!a.actief)return{success:!1,error:"Account is gedeactiveerd"};return s(a),localStorage.setItem("audit_user",JSON.stringify(a)),{success:!0}}catch(e){return{success:!1,error:"Er is een fout opgetreden bij het inloggen"}}},c=async()=>{s(null),"undefined"!=typeof localStorage&&localStorage.removeItem("audit_user")},g=async e=>{try{if(console.log("\uD83D\uDD04 updateUser called with updates:",e),!a)return console.log("❌ No user logged in"),{success:!1,error:"Geen gebruiker ingelogd"};if("undefined"==typeof localStorage)return{success:!1,error:"Server-side rendering not supported"};console.log("\uD83D\uDC64 Current user:",a),console.log("\uD83D\uDD0D Updating user in database with ID:",a.id);let t=await n.l.updateUser(a.id,e);if(console.log("\uD83D\uDCBE Database update result:",t),!t)return console.log("❌ User not found in database"),{success:!1,error:"Gebruiker niet gevonden"};let i={id:t.id,user_id:t.email,naam:t.naam,rol:t.rol,telefoon:t.telefoon,actief:t.actief,created_at:t.created_at,updated_at:t.updated_at};return console.log("✅ Converted to authUser:",i),console.log("\uD83D\uDCBE Updating localStorage..."),s(i),localStorage.setItem("audit_user",JSON.stringify(i)),console.log("✅ User updated successfully in both state and localStorage"),{success:!0}}catch(e){return console.error("❌ Error updating user:",e),{success:!1,error:"Er is een fout opgetreden bij het bijwerken van het profiel"}}};return(0,i.jsx)(o.Provider,{value:{user:a,loading:l,signOut:c,signIn:u,updateUser:g},children:t})}},9756:function(e,t,a){a.d(t,{l:function(){return l}}),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString(),new Date().toISOString();let i=[{id:"action-1",audit_id:"audit-1",audit_resultaat_id:"result-1",titel:"Actie vereist: Koelkast FIFO",beschrijving:"FIFO regel niet correct nageleefd in de koelkast. Producten moeten worden hergeorganiseerd volgens vervaldatum.",urgentie:"high",status:"pending",deadline:"2024-01-22",created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z"},{id:"action-2",audit_id:"audit-1",audit_resultaat_id:"result-2",titel:"Actie vereist: Vloeren schoonmaken",beschrijving:"Vloeren in de keuken zijn niet voldoende schoon. Extra schoonmaakbeurt nodig.",urgentie:"medium",status:"in_progress",deadline:"2024-01-29",created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z"},{id:"action-3",audit_id:"audit-2",audit_resultaat_id:"result-3",titel:"Actie vereist: Koelkast temperatuur",beschrijving:"Koelkast temperatuur is te hoog (8\xb0C). Moet worden aangepast naar 4\xb0C of lager voor voedselveiligheid.",urgentie:"critical",status:"completed",deadline:"2024-01-16",actie_onderneem:"Koelkast temperatuur aangepast naar 3\xb0C. Thermometer gecontroleerd en gekalibreerd.",foto_urls:["/uploads/koelkast-temperatuur-voor.jpg","/uploads/koelkast-temperatuur-na.jpg"],voltooid_door:"demo-user-1",voltooid_op:"2024-01-16T14:30:00Z",created_at:"2024-01-08T14:30:00Z",updated_at:"2024-01-16T14:30:00Z"},{id:"action-4",audit_id:"audit-2",audit_resultaat_id:"result-4",titel:"Actie vereist: FIFO controle koelkast",beschrijving:"FIFO regel niet correct nageleefd. Oudere producten staan voor nieuwe producten.",urgentie:"high",status:"verified",deadline:"2024-01-18",actie_onderneem:"Alle producten in koelkast hergeorganiseerd volgens vervaldatum. Personeel getraind op FIFO procedures.",foto_urls:["/uploads/koelkast-fifo-voor.jpg","/uploads/koelkast-fifo-na.jpg"],voltooid_door:"demo-user-1",voltooid_op:"2024-01-18T09:15:00Z",geverifieerd_door:"demo-user-1",geverifieerd_op:"2024-01-18T16:00:00Z",verificatie_opmerkingen:"Koelkast correct georganiseerd volgens FIFO. Personeel heeft training gevolgd.",created_at:"2024-01-08T14:30:00Z",updated_at:"2024-01-18T16:00:00Z"},{id:"action-5",audit_id:"audit-2",audit_resultaat_id:"result-5",titel:"Actie vereist: Gevel reinigen",beschrijving:"Gevel en ramen zijn vuil en hebben een professionele reiniging nodig.",urgentie:"low",status:"pending",deadline:"2024-02-05",created_at:"2024-01-08T14:30:00Z",updated_at:"2024-01-08T14:30:00Z"},{id:"action-6",audit_id:"audit-3",audit_resultaat_id:"result-6",titel:"Actie vereist: Ingang deur repareren",beschrijving:"Ingang deur sluit niet goed af. Reparatie nodig voor veiligheid en energiebesparing.",urgentie:"medium",status:"in_progress",deadline:"2024-01-26",created_at:"2024-01-12T09:15:00Z",updated_at:"2024-01-12T09:15:00Z"},{id:"action-7",audit_id:"audit-3",audit_resultaat_id:"result-7",titel:"Actie vereist: Vloeren vervangen",beschrijving:"Vloeren in de keuken zijn versleten en moeten worden vervangen voor hygi\xebne.",urgentie:"high",status:"pending",deadline:"2024-02-12",created_at:"2024-01-12T09:15:00Z",updated_at:"2024-01-12T09:15:00Z"}];class r{loadFromStorage(){try{if("undefined"==typeof localStorage){console.log("\uD83C\uDF10 Server-side rendering detected, using default data"),this.initializeData();return}let e=localStorage.getItem("audit_database");if(e){let t=JSON.parse(e);console.log("\uD83D\uDCE6 Loading database from localStorage:",t),this.users=t.users||[],this.filialen=t.filialen||[],this.audits=t.audits||[],this.checklistItems=t.checklistItems||[],this.actions=t.actions||[],this.auditResults=t.auditResults||[],console.log("\uD83D\uDD0D Loaded audit results from storage:",this.auditResults.length),console.log("\uD83D\uDD0D Loaded actions from storage:",this.actions.length,"actions"),this.actions&&0!==this.actions.length||(console.log("⚠️ No actions found in storage, reinitializing..."),this.actions=[...i],this.saveToStorage()),console.log("✅ Database loaded from localStorage")}else console.log("\uD83D\uDCED No stored database found, initializing with default data"),this.initializeData(),this.saveToStorage()}catch(e){console.error("❌ Error loading database from localStorage:",e),console.log("\uD83D\uDD04 Falling back to default data"),this.initializeData(),this.saveToStorage()}}saveToStorage(){try{if("undefined"==typeof localStorage){console.log("\uD83C\uDF10 Server-side rendering detected, skipping localStorage save");return}this.auditResults.length>100&&(console.log("\uD83E\uDDF9 Cleaning old audit results to prevent quota exceeded"),this.auditResults=this.auditResults.slice(-50));let e={users:this.users,filialen:this.filialen,audits:this.audits,checklistItems:this.checklistItems,actions:this.actions,auditResults:this.auditResults},t=JSON.stringify(e);console.log("\uD83D\uDCBE Data size:",Math.round(t.length/1024),"KB"),localStorage.setItem("audit_database",t),console.log("\uD83D\uDCBE Database saved to localStorage"),console.log("\uD83D\uDCBE Audit results saved:",this.auditResults.length)}catch(e){if(console.error("❌ Error saving database to localStorage:",e),"QuotaExceededError"===e.name){console.log("\uD83E\uDDF9 Quota exceeded, clearing old data and retrying..."),this.clearOldData();try{let e={users:this.users,filialen:this.filialen,audits:this.audits,checklistItems:this.checklistItems,actions:this.actions,auditResults:this.auditResults};localStorage.setItem("audit_database",JSON.stringify(e)),console.log("✅ Database saved after cleanup")}catch(e){console.error("❌ Still failed after cleanup:",e)}}}}clearOldData(){this.audits=this.audits.slice(-20),this.auditResults=this.auditResults.slice(-50),console.log("\uD83E\uDDF9 Cleared old data, kept:",this.audits.length,"audits and",this.auditResults.length,"results")}initializeData(){this.actions=[...i],console.log("\uD83D\uDD0D Initialized actions:",this.actions.length,"actions"),console.log("\uD83D\uDD0D Actions data:",this.actions),this.users=[{id:"00000000-0000-0000-0000-000000000001",email:"ADMIN",naam:"Admin User",rol:"admin",telefoon:"+32 123 456 789",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"00000000-0000-0000-0000-000000000002",email:"MAN01",naam:"COO Manager",rol:"coo",telefoon:"+32 123 456 790",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"00000000-0000-0000-0000-000000000003",email:"MAN02",naam:"District Manager",rol:"district_manager",telefoon:"+32 123 456 791",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"00000000-0000-0000-0000-000000000004",email:"USER1",naam:"User",rol:"user",telefoon:"+32 123 456 792",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}],this.filialen=[{id:"filiaal-1",naam:"Gent - KM11",locatie:"Gent",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Korenmarkt 11, 9000 Gent",telefoon:"+32 9 245 75 85",email:"km11@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"filiaal-2",naam:"Etterbeek - PJ70",locatie:"Etterbeek",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Place Jourdan 70, 1040 Etterbeek",telefoon:"+32 2 759 42 97",email:"pj70@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"filiaal-3",naam:"Mechelen - IL36",locatie:"Mechelen",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Ijzerenleen 36, 2800 Mechelen",telefoon:"+32 15 528 35 1",email:"il36@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"filiaal-4",naam:"Leuven - TS15",locatie:"Leuven",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Tiensestraat 15, 3000 Leuven",telefoon:"+32 16 792 15 2",email:"ts15@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"filiaal-5",naam:"Antwerpen - GK2",locatie:"Antwerpen",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Godfrieduskaai 2, 2000 Antwerpen",telefoon:"+32 3 828 38 22",email:"gk2@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"filiaal-6",naam:"Oostende - IL34",locatie:"Oostende",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Leopold II Laan 34, 8400 Oostende",telefoon:"+32 59 709 25 55",email:"il34@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"filiaal-7",naam:"Brussel - TL24",locatie:"Brussel",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Tervurenlaan 24a, 1040 Brussel",telefoon:"+32 2 895 57 00",email:"tl24@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"filiaal-8",naam:"Brussel - SC2",locatie:"Brussel",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Place Saint-Catherine 2, 1000 Brussel",telefoon:"+32 2 895 57 00",email:"sc2@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"filiaal-9",naam:"Brugge - SS3",locatie:"Brugge",district_manager_id:"00000000-0000-0000-0000-000000000003",adres:"Simon Stevinplein 3, 8000 Brugge",telefoon:"+32 50 893 70 00",email:"ss3@poulepoulette.com",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}],this.checklistItems=[{id:"item-1",categorie:"Buitenkant Zaak",titel:"Terras uitnodigend (tafels ingedekt - operationeel)",beschrijving:"Controleer of de tafels netjes zijn gedekt, het terras netjes wordt gepresenteerd en gereed is voor gasten",gewicht:1.5,volgorde:1,actief:!0,created_at:new Date().toISOString()},{id:"item-2",categorie:"Buitenkant Zaak",titel:"Terras proper (vloer/meubilair)",beschrijving:"Vloer en meubilair moeten schoon zijn en er mag geen rommel liggen",gewicht:1.3,volgorde:2,actief:!0,created_at:new Date().toISOString()},{id:"item-3",categorie:"Buitenkant Zaak",titel:"Plantenbakken ok",beschrijving:"Planten mogen niet verwelkt of vuil zijn, dit draagt bij aan een verzorgde uitstraling",gewicht:1,volgorde:3,actief:!0,created_at:new Date().toISOString()},{id:"item-4",categorie:"Spotchecks",titel:"Inkomzone proper en ordelijk",beschrijving:"De ingang moet netjes en opgeruimd zijn. Geen rommel, schone vloeren en geen obstakels",gewicht:1.5,volgorde:4,actief:!0,created_at:new Date().toISOString()},{id:"item-5",categorie:"Spotchecks",titel:"Geen sporen van ongedierte (vallen, uitwerpselen, vliegen)",beschrijving:"Controleer op tekenen van ongedierte. Dit kan vallen voor insecten zijn, of sporen van muizen of andere dieren",gewicht:2,volgorde:5,actief:!0,created_at:new Date().toISOString()},{id:"item-6",categorie:"Spotchecks",titel:"Vuil- of risicoplaatsen proper (achter toestellen, onder meubels, afvalzone, schoonmaakruimte, ventilatieroosters)",beschrijving:"Deze plekken worden vaak over het hoofd gezien, maar ze kunnen ophoping van vuil of ongedierte veroorzaken",gewicht:1.8,volgorde:6,actief:!0,created_at:new Date().toISOString()},{id:"item-7",categorie:"Algemene Properheid",titel:"Keuken",beschrijving:"Werkbladen moeten schoon zijn zonder etensresten, en alle producten moeten goed afgesloten zijn om besmetting te voorkomen",gewicht:2,volgorde:7,actief:!0,created_at:new Date().toISOString()},{id:"item-8",categorie:"Algemene Properheid",titel:"Zaal",beschrijving:"Tafels en stoelen moeten schoon zijn, de vloer mag geen vuil bevatten",gewicht:1.5,volgorde:8,actief:!0,created_at:new Date().toISOString()},{id:"item-9",categorie:"Algemene Properheid",titel:"Toiletten",beschrijving:"Ze moeten goed voorzien zijn (papier, zeep), geurvrij en hygi\xebnisch",gewicht:1.8,volgorde:9,actief:!0,created_at:new Date().toISOString()},{id:"item-10",categorie:"Algemene Properheid",titel:"Kelder",beschrijving:"De kelder moet schoon, droog en georganiseerd zijn om risico's van schimmel of vuil te vermijden",gewicht:1.3,volgorde:10,actief:!0,created_at:new Date().toISOString()},{id:"item-11",categorie:"Algemene Properheid",titel:"Extra ruimtes/kleedkamers",beschrijving:"Persoonlijke spullen moeten opgeborgen zijn en de ruimte moet netjes zijn",gewicht:1,volgorde:11,actief:!0,created_at:new Date().toISOString()},{id:"item-12",categorie:"FIFO Controle",titel:"Frigo keuken",beschrijving:"In de koelkasten moet volgens het FIFO-principe (First In, First Out) gewerkt worden en mogen er geen verlopen producten zijn",gewicht:2,volgorde:12,actief:!0,created_at:new Date().toISOString()},{id:"item-13",categorie:"FIFO Controle",titel:"Vriezer keuken",beschrijving:"Vriezer moet goed gelabeld zijn met datums en producten moeten goed georganiseerd zijn",gewicht:1.8,volgorde:13,actief:!0,created_at:new Date().toISOString()},{id:"item-14",categorie:"FIFO Controle",titel:"Frigo's bar",beschrijving:"Ook hier moet FIFO gevolgd worden en de frigo moet ordelijk zijn zonder verlopen producten",gewicht:1.5,volgorde:14,actief:!0,created_at:new Date().toISOString()},{id:"item-15",categorie:"Operationele Checks",titel:"Personeelsbezetting & planning",beschrijving:"Is het personeel voldoende en goed ingepland voor de drukte? Zorg voor een goede balans tussen rust en piekuren",gewicht:1.5,volgorde:15,actief:!0,created_at:new Date().toISOString()},{id:"item-16",categorie:"Operationele Checks",titel:"Kassaprocedures en dagrapporten",beschrijving:"Is alles correct geregistreerd en zijn de dagrapporten accuraat?",gewicht:1.3,volgorde:16,actief:!0,created_at:new Date().toISOString()},{id:"item-17",categorie:"Operationele Checks",titel:"Voorraadniveaus",beschrijving:"Zorg ervoor dat de voorraad op peil is en er geen tekorten zijn voor de operationele uren",gewicht:1.2,volgorde:17,actief:!0,created_at:new Date().toISOString()},{id:"item-18",categorie:"Operationele Checks",titel:"Acties en promoties correct uitgevoerd",beschrijving:"Zijn de promoties correct gepromoot en uitgevoerd volgens de afspraken?",gewicht:1,volgorde:18,actief:!0,created_at:new Date().toISOString()},{id:"item-19",categorie:"Operationele Checks",titel:"Gastbeleving en servicekwaliteit",beschrijving:"Hoe wordt de service ervaren door de gasten? Is er ruimte voor verbetering?",gewicht:1.8,volgorde:19,actief:!0,created_at:new Date().toISOString()},{id:"item-20",categorie:"Operationele Checks",titel:"Veiligheid (brandblussers, nooduitgangen, EHBO)",beschrijving:"Controleer of de veiligheidsmaatregelen op hun plaats zijn en goed werken",gewicht:1.5,volgorde:20,actief:!0,created_at:new Date().toISOString()}],this.audits=[{id:"audit-1",filiaal_id:"filiaal-1",district_manager_id:"00000000-0000-0000-0000-000000000003",audit_datum:"2024-01-15",status:"completed",totale_score:4.2,pass_percentage:84,opmerkingen:"Goede algemene staat, kleine verbeterpunten bij FIFO controle",created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z"},{id:"audit-2",filiaal_id:"filiaal-1",district_manager_id:"00000000-0000-0000-0000-000000000003",audit_datum:"2024-01-08",status:"completed",totale_score:3.8,pass_percentage:76,opmerkingen:"Koelkast temperatuur te hoog, FIFO niet correct nageleefd",created_at:"2024-01-08T14:30:00Z",updated_at:"2024-01-08T14:30:00Z"},{id:"audit-3",filiaal_id:"filiaal-2",district_manager_id:"00000000-0000-0000-0000-000000000003",audit_datum:"2024-01-12",status:"completed",totale_score:4.6,pass_percentage:92,opmerkingen:"Uitstekende staat, alle punten in orde",created_at:"2024-01-12T09:15:00Z",updated_at:"2024-01-12T09:15:00Z"}]}async getUserByEmail(e){console.log("Looking for user with email:",e),console.log("Available users:",this.users.map(e=>e.email));let t=this.users.find(t=>t.email===e)||null;return console.log("Found user:",t),t}async getUserById(e){return this.users.find(t=>t.id===e)||null}async getAllUsers(){return this.users}generateUserCode(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let a=0;a<5;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return this.users.find(e=>e.email===t)?this.generateUserCode():t}async createUser(e){let t=this.generateUserCode(),a={id:"user-".concat(Date.now()),email:t,naam:e.naam,rol:e.rol,telefoon:e.telefoon,actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return this.users.push(a),this.saveToStorage(),a}async deleteUser(e){let t=this.users.findIndex(t=>t.id===e);return -1!==t&&(this.users.splice(t,1),this.saveToStorage(),!0)}async updateUser(e,t){console.log("\uD83D\uDD0D localDb.updateUser called with:"),console.log("  - id:",e),console.log("  - updates:",t),console.log("  - current users:",this.users.map(e=>({id:e.id,email:e.email,naam:e.naam})));let a=this.users.findIndex(t=>t.id===e);if(console.log("\uD83D\uDD0D Found user at index:",a),-1!==a){console.log("\uD83D\uDC64 Old user data:",this.users[a]),this.users[a]={...this.users[a],...t,updated_at:new Date().toISOString()};let e=this.users[a];return console.log("✅ Updated user data:",e),console.log("\uD83D\uDCCA All users after update:",this.users.map(e=>({id:e.id,email:e.email,naam:e.naam}))),this.saveToStorage(),console.log("\uD83D\uDCBE Database saved after user update"),e}return console.log("❌ User not found with id:",e),null}async getFilialen(){return this.filialen.filter(e=>"actief"===e.status)}async getFiliaalById(e){return this.filialen.find(t=>t.id===e)||null}async getActions(e){if(console.log("\uD83D\uDD0D getActions called with filiaalId:",e),console.log("\uD83D\uDD0D Total actions in database:",this.actions.length),console.log("\uD83D\uDD0D Actions data:",this.actions),e&&"all"!==e){let t=this.audits.filter(t=>t.filiaal_id===e),a=t.map(e=>e.id);console.log("\uD83D\uDD0D Filiaal audits:",t),console.log("\uD83D\uDD0D Audit IDs:",a);let i=this.actions.filter(e=>a.includes(e.audit_id));return console.log("\uD83D\uDD0D Filtered actions:",i),i}return console.log("\uD83D\uDD0D Returning all actions:",this.actions),this.actions}async getActionById(e){return this.actions.find(t=>t.id===e)||null}async updateAction(e,t){let a=this.actions.findIndex(t=>t.id===e);return -1!==a?(this.actions[a]={...this.actions[a],...t,updated_at:new Date().toISOString()},this.saveToStorage(),this.actions[a]):null}async addAuditResults(e,t){console.log("\uD83D\uDD0D Adding audit results for audit:",e),console.log("\uD83D\uDCCA Results to save:",t),this.auditResults=this.auditResults.filter(t=>t.audit_id!==e),t.forEach((t,a)=>{let i={id:"result-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2)),audit_id:e,checklist_item_id:t.checklist_item_id,resultaat:t.resultaat,score:"ok"===t.resultaat?5:0,opmerkingen:t.opmerkingen||null,foto_urls:t.foto_urls||[],verbeterpunt:t.verbeterpunt||null,created_at:new Date().toISOString()};console.log("\uD83D\uDCBE Saving result ".concat(a+1,":"),{checklist_item_id:i.checklist_item_id,resultaat:i.resultaat,opmerkingen:i.opmerkingen,verbeterpunt:i.verbeterpunt,foto_count:i.foto_urls.length}),this.auditResults.push(i)}),this.auditResults.length>100&&(console.log("\uD83E\uDDF9 Cleaning old audit results before saving"),this.auditResults=this.auditResults.slice(-50)),this.saveToStorage(),console.log("✅ Audit results added:",t.length,"results for audit",e),console.log("\uD83D\uDCC8 Total audit results in database:",this.auditResults.length)}async getAuditResults(e){let t=this.auditResults.filter(t=>t.audit_id===e);return console.log("\uD83D\uDD0D Loading audit results for audit:",e),console.log("\uD83D\uDCCA Found results:",t.length),console.log("\uD83D\uDCCA Total audit results in database:",this.auditResults.length),console.log("\uD83D\uDCCA All audit IDs in database:",this.auditResults.map(e=>e.audit_id)),0===t.length&&(console.log("⚠️ No results found for audit ID:",e),console.log("⚠️ Available audit IDs:",Array.from(new Set(this.auditResults.map(e=>e.audit_id))))),t.forEach((e,t)=>{console.log("\uD83D\uDCCB Result ".concat(t+1,":"),{checklist_item_id:e.checklist_item_id,resultaat:e.resultaat,opmerkingen:e.opmerkingen,verbeterpunt:e.verbeterpunt,foto_count:e.foto_urls.length})}),t}async getAudits(e){let t=this.audits;return e&&(t=t.filter(t=>t.filiaal_id===e)),t.sort((e,t)=>new Date(t.audit_datum).getTime()-new Date(e.audit_datum).getTime())}async getAuditById(e){return this.audits.find(t=>t.id===e)||null}async addAudit(e){this.audits.push(e),this.saveToStorage(),console.log("Audit added:",e.id)}async createAudit(e){let t={id:"audit-".concat(Date.now()),filiaal_id:e.filiaal_id,district_manager_id:e.district_manager_id,audit_datum:e.audit_datum,status:"in_progress",totale_score:0,pass_percentage:0,opmerkingen:e.opmerkingen||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return this.audits.push(t),this.saveToStorage(),t}async updateAudit(e,t){let a=this.audits.findIndex(t=>t.id===e);return -1!==a?(this.audits[a]={...this.audits[a],...t,updated_at:new Date().toISOString()},this.saveToStorage(),this.audits[a]):null}async deleteAudit(e){let t=this.audits.findIndex(t=>t.id===e);return -1!==t&&(this.audits.splice(t,1),this.auditResults=this.auditResults.filter(t=>t.audit_id!==e),this.actions=this.actions.filter(t=>t.audit_id!==e),this.saveToStorage(),!0)}async createFiliaal(e){let t={id:"filiaal-".concat(Date.now()),naam:e.naam,locatie:e.locatie,district_manager_id:e.district_manager_id,adres:e.adres,telefoon:e.telefoon||"",email:e.email||"",status:"actief",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return this.filialen.push(t),this.saveToStorage(),t}async getChecklistItems(){return this.checklistItems.filter(e=>e.actief)}async getKPIData(e){let t=this.audits;e&&(t=t.filter(t=>t.filiaal_id===e));let a=t.length;return{totaal_audits:a,gemiddelde_score:Math.round(100*(t.length>0?t.reduce((e,t)=>e+t.totale_score,0)/t.length:0))/100,pass_percentage:Math.round(100*(t.length>0?t.filter(e=>e.pass_percentage>=80).length/t.length*100:0))/100,verbeterpunten:this.generateVerbeterpunten(t),trends:[{periode:"Week 1",score:3.8,audits:1},{periode:"Week 2",score:4.4,audits:2}]}}generateVerbeterpunten(e){let t=new Map,a={"Koelkast FIFO":["FIFO","koelkast","verlopen","producten","organisatie"],"Koelkast temperatuur":["temperatuur","koelkast","te hoog","te laag","koud"],"Hygi\xebne keuken":["hygi\xebne","keuken","schoon","werkbladen","etensresten"],"Terras properheid":["terras","vloer","meubilair","rommel","schoon"],Toiletten:["toiletten","papier","zeep","geur","hygi\xebnisch"],Personeelsbezetting:["personeel","bezetting","planning","drukte","balans"],Voorraadniveaus:["voorraad","tekorten","niveaus","op peil"],Veiligheid:["veiligheid","brandblussers","nooduitgangen","EHBO"],Gastbeleving:["gastbeleving","service","kwaliteit","ervaring"],Kassaprocedures:["kassa","procedures","dagrapporten","registratie"]};return e.forEach(e=>{if(e.opmerkingen){let i=e.opmerkingen.toLowerCase();Object.entries(a).forEach(a=>{let[r,n]=a;if(n.some(e=>i.includes(e))){let a=t.get(r);a?(a.frequentie++,new Date(e.audit_datum)>new Date(a.laatste_voorkomen)&&(a.laatste_voorkomen=e.audit_datum)):t.set(r,{frequentie:1,laatste_voorkomen:e.audit_datum})}})}}),Array.from(t.entries()).map(e=>{let[t,a]=e;return{item:t,frequentie:a.frequentie,laatste_voorkomen:a.laatste_voorkomen}}).sort((e,t)=>t.frequentie-e.frequentie).slice(0,5)}constructor(){this.users=[],this.filialen=[],this.audits=[],this.checklistItems=[],this.actions=[],this.auditResults=[],console.log("Initializing LocalDatabase..."),this.loadFromStorage(),console.log("LocalDatabase initialized with",this.users.length,"users"),console.log("Users:",this.users.map(e=>e.email))}}let n=new r;console.log("LocalDatabase singleton created:",n);var o=a(501);class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}async initialize(){this.isInitialized||(this.isInitialized=!0,console.log("ClientDataService initialized in DEMO MODE - using local database"))}async authenticateUser(e,t){if(console.log("\uD83D\uDD10 DEMO MODE: Authenticating user:",e),["ADMIN","MAN01","MAN02","USER1"].includes(e)){let t=await n.getUserByEmail(e);if(t)return console.log("✅ DEMO authentication successful:",t.email),t}return console.log("❌ DEMO authentication failed for:",e),null}async getUserById(e){try{let t=await n.getUserById(e);if(t)return t}catch(e){console.log("❌ DEMO getUserById failed:",e)}return null}async getFilialen(e){try{return await n.getFilialen()}catch(e){return console.log("❌ DEMO getFilialen failed:",e),[]}}async getFiliaalById(e){try{return await n.getFiliaalById(e)}catch(e){return console.log("❌ DEMO getFiliaalById failed:",e),null}}async getAudits(e){try{return await n.getAudits(null==e?void 0:e.filiaalId)}catch(e){return console.log("❌ DEMO getAudits failed:",e),[]}}async getAuditById(e){try{return await n.getAuditById(e)}catch(e){return console.log("❌ DEMO getAuditById failed:",e),null}}async createAudit(e){try{return await n.createAudit(e)}catch(e){throw console.log("❌ DEMO createAudit failed:",e),e}}async updateAudit(e,t){try{return await n.updateAudit(e,t)}catch(e){return console.log("❌ DEMO updateAudit failed:",e),null}}async getChecklistItems(){try{return await n.getChecklistItems()}catch(e){return console.log("❌ DEMO getChecklistItems failed:",e),[]}}async getKPIData(e){try{return await n.getKPIData(e)}catch(e){return console.log("❌ DEMO getKPIData failed:",e),{totaal_audits:0,gemiddelde_score:0,pass_percentage:0,verbeterpunten:[],trends:[]}}}async getActions(e){try{return await n.getActions(e)}catch(e){return console.log("❌ DEMO getActions failed:",e),[]}}async getActionById(e){try{return await n.getActionById(e)}catch(e){return console.log("❌ DEMO getActionById failed:",e),null}}async updateAction(e,t){try{return await n.updateAction(e,t)}catch(e){return console.log("❌ DEMO updateAction failed:",e),null}}async getAllUsers(){try{return await n.getAllUsers()}catch(e){return console.log("❌ DEMO getAllUsers failed:",e),[]}}async createUser(e){try{return await n.createUser({naam:e.naam||"",rol:e.rol||"user",telefoon:e.telefoon||""})}catch(e){throw console.log("❌ DEMO createUser failed:",e),e}}async deleteUser(e){try{return await n.deleteUser(e)}catch(e){return console.log("❌ DEMO deleteUser failed:",e),!1}}async updateUser(e,t){try{return await n.updateUser(e,t)}catch(e){return console.log("❌ DEMO updateUser failed:",e),null}}async getUserByEmail(e){try{return await n.getUserByEmail(e)}catch(e){return console.log("❌ DEMO getUserByEmail failed:",e),null}}async addAuditResults(e,t){try{return await n.addAuditResults(e,t)}catch(e){throw console.log("❌ DEMO addAuditResults failed:",e),e}}async getAuditResults(e){try{return await n.getAuditResults(e)}catch(e){return console.log("❌ DEMO getAuditResults failed:",e),[]}}async deleteAudit(e){try{return await n.deleteAudit(e)}catch(e){throw console.log("❌ DEMO deleteAudit failed:",e),e}}async uploadFile(e){try{let t=await (0,o.cT)(e);if(t.success&&t.url)return{url:t.url,filename:e.name};throw Error(t.error||"Upload failed")}catch(e){throw console.log("❌ DEMO uploadFile failed:",e),e}}constructor(){this.isInitialized=!1,this.initialize()}}let l=s.getInstance()},501:function(e,t,a){a.d(t,{D0:function(){return n},_I:function(){return r},cT:function(){return i}});let i=async function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&arguments[2];try{return new Promise(t=>{let a=new FileReader;a.onload=()=>{t({success:!0,url:a.result})},a.onerror=()=>{t({success:!1,error:"Failed to read file"})},a.readAsDataURL(e)})}catch(e){return console.error("Upload error:",e),{success:!1,error:"Upload failed"}}},r=async function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return{success:!0}}catch(e){return console.error("Delete error:",e),{success:!1,error:"Delete failed"}}},n=e=>e.size>10485760?{valid:!1,error:"Bestand is te groot. Maximum grootte is 10MB."}:["image/jpeg","image/png","image/webp"].includes(e.type)?{valid:!0}:{valid:!1,error:"Alleen JPEG, PNG en WebP bestanden zijn toegestaan."}}}]);