"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{1618:function(e,t,r){r.d(t,{AuthProvider:function(){return o},a:function(){return s}});var a=r(7437),n=r(2265),i=r(1181);let l=(0,n.createContext)(void 0),s=()=>{let e=(0,n.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},o=e=>{let{children:t}=e,[r,s]=(0,n.useState)(null),[o,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=async()=>{try{if("undefined"==typeof localStorage){console.log("\uD83C\uDF10 Server-side rendering detected, skipping auth check"),u(!1);return}let e=localStorage.getItem("audit_user");if(console.log("\uD83D\uDD0D Checking existing session..."),console.log("\uD83D\uDCE6 Saved user from localStorage:",e),e)try{let t=JSON.parse(e);console.log("\uD83D\uDC64 Parsed user:",t),console.log("\uD83D\uDD04 Using saved user directly (skipping database lookup)"),s(t),console.log("✅ User set from localStorage")}catch(e){console.error("❌ Error parsing localStorage user:",e),localStorage.removeItem("audit_user")}else console.log("\uD83D\uDCED No saved user found in localStorage")}catch(e){console.error("❌ Error in checkExistingSession:",e)}finally{console.log("\uD83C\uDFC1 Setting loading to false"),u(!1)}},t=setTimeout(()=>{console.log("⏰ Auth check timeout, setting loading to false"),u(!1)},3e3);e().finally(()=>{clearTimeout(t)})},[]);let c=async e=>{try{if("undefined"==typeof localStorage)return{success:!1,error:"Server-side rendering not supported"};let t=await i.l.getUserByEmail(e);if(t){let e={id:t.id,user_id:t.email,naam:t.naam,rol:t.rol,telefoon:t.telefoon,actief:t.actief,created_at:t.created_at,updated_at:t.updated_at};if(!e.actief)return{success:!1,error:"Account is gedeactiveerd"};return s(e),localStorage.setItem("audit_user",JSON.stringify(e)),{success:!0}}let r={ADMIN:{id:"00000000-0000-0000-0000-000000000001",user_id:"ADMIN",naam:"Admin User",rol:"admin",telefoon:"+32 123 456 789",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},MAN01:{id:"00000000-0000-0000-0000-000000000002",user_id:"MAN01",naam:"COO Manager",rol:"coo",telefoon:"+32 123 456 790",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},MAN02:{id:"00000000-0000-0000-0000-000000000003",user_id:"MAN02",naam:"District Manager",rol:"district_manager",telefoon:"+32 123 456 791",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},USER1:{id:"00000000-0000-0000-0000-000000000004",user_id:"USER1",naam:"User",rol:"user",telefoon:"+32 123 456 792",actief:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}[e];if(!r)return{success:!1,error:"User ID niet gevonden"};if(!r.actief)return{success:!1,error:"Account is gedeactiveerd"};return s(r),localStorage.setItem("audit_user",JSON.stringify(r)),{success:!0}}catch(e){return{success:!1,error:"Er is een fout opgetreden bij het inloggen"}}},d=async()=>{s(null),"undefined"!=typeof localStorage&&localStorage.removeItem("audit_user")},g=async e=>{try{if(console.log("\uD83D\uDD04 updateUser called with updates:",e),!r)return console.log("❌ No user logged in"),{success:!1,error:"Geen gebruiker ingelogd"};if("undefined"==typeof localStorage)return{success:!1,error:"Server-side rendering not supported"};console.log("\uD83D\uDC64 Current user:",r),console.log("\uD83D\uDD0D Updating user in database with ID:",r.id);let t=await i.l.updateUser(r.id,e);if(console.log("\uD83D\uDCBE Database update result:",t),!t)return console.log("❌ User not found in database"),{success:!1,error:"Gebruiker niet gevonden"};let a={id:t.id,user_id:t.email,naam:t.naam,rol:t.rol,telefoon:t.telefoon,actief:t.actief,created_at:t.created_at,updated_at:t.updated_at};return console.log("✅ Converted to authUser:",a),console.log("\uD83D\uDCBE Updating localStorage..."),s(a),localStorage.setItem("audit_user",JSON.stringify(a)),console.log("✅ User updated successfully in both state and localStorage"),{success:!0}}catch(e){return console.error("❌ Error updating user:",e),{success:!1,error:"Er is een fout opgetreden bij het bijwerken van het profiel"}}};return(0,a.jsx)(l.Provider,{value:{user:r,loading:o,signOut:d,signIn:c,updateUser:g},children:t})}},1181:function(e,t,r){r.d(t,{l:function(){return s}});var a=r(2141);class n{async authenticateUser(e,t){try{let{data:t,error:r}=await a.O.from("gebruikers").select("*").eq("user_id",e).single();if(r||!t)return null;return t}catch(e){return console.error("Authentication error:",e),null}}async getUserById(e){try{let{data:t,error:r}=await a.O.from("gebruikers").select("*").eq("id",e).single();if(r)return null;return t}catch(e){return console.error("Get user error:",e),null}}async getUserByUserId(e){try{let{data:t,error:r}=await a.O.from("gebruikers").select("*").eq("user_id",e).single();if(r)return null;return t}catch(e){return console.error("Get user by user_id error:",e),null}}async getFilialen(e){try{let t=a.O.from("filialen").select("*");e&&(t=t.eq("district_manager_id",e));let{data:r,error:n}=await t;if(n)return console.error("Get filialen error:",n),[];return r}catch(e){return console.error("Get filialen error:",e),[]}}async getFiliaalById(e){try{let{data:t,error:r}=await a.O.from("filialen").select("*").eq("id",e).single();if(r)return null;return t}catch(e){return console.error("Get filiaal error:",e),null}}async getAudits(e){try{let t=a.O.from("audits").select("\n          *,\n          filialen:filiaal_id (\n            id,\n            naam,\n            locatie,\n            adres,\n            telefoon,\n            email,\n            status\n          ),\n          gebruikers:district_manager_id (\n            id,\n            user_id,\n            naam,\n            rol,\n            telefoon,\n            actief\n          )\n        ");(null==e?void 0:e.filiaalId)&&(t=t.eq("filiaal_id",e.filiaalId)),(null==e?void 0:e.districtManagerId)&&(t=t.eq("district_manager_id",e.districtManagerId)),(null==e?void 0:e.status)&&(t=t.eq("status",e.status)),(null==e?void 0:e.limit)&&(t=t.limit(e.limit)),(null==e?void 0:e.offset)&&(t=t.range(e.offset,e.offset+(e.limit||50)-1));let{data:r,error:n}=await t.order("audit_datum",{ascending:!1});if(n)return console.error("Get audits error:",n),[];return(r||[]).map(e=>({...e,filiaal:e.filialen,district_manager:e.gebruikers}))}catch(e){return console.error("Get audits error:",e),[]}}async getAuditById(e){try{let{data:t,error:r}=await a.O.from("audits").select("\n          *,\n          filialen:filiaal_id (\n            id,\n            naam,\n            locatie,\n            adres,\n            telefoon,\n            email,\n            status\n          ),\n          gebruikers:district_manager_id (\n            id,\n            user_id,\n            naam,\n            rol,\n            telefoon,\n            actief\n          )\n        ").eq("id",e).single();if(r)return null;return{...t,filiaal:t.filialen,district_manager:t.gebruikers}}catch(e){return console.error("Get audit error:",e),null}}async createAudit(e){try{let{data:t,error:r}=await a.O.from("audits").insert({filiaal_id:e.filiaal_id,district_manager_id:e.district_manager_id,audit_datum:e.audit_datum,status:e.status||"in_progress",totale_score:e.totale_score||0,pass_percentage:e.pass_percentage||0,opmerkingen:e.opmerkingen}).select().single();if(r)throw r;return t}catch(e){throw console.error("Create audit error:",e),e}}async updateAudit(e,t){try{let{data:r,error:n}=await a.O.from("audits").update(t).eq("id",e).select().single();if(n)return null;return r}catch(e){return console.error("Update audit error:",e),null}}async addAuditResults(e,t){try{await a.O.from("audit_resultaten").delete().eq("audit_id",e);let r=t.map(t=>({audit_id:e,checklist_item_id:t.checklist_item_id,resultaat:t.resultaat,score:"ok"===t.resultaat?5:0,opmerkingen:t.opmerkingen||null,foto_urls:t.foto_urls||[],verbeterpunt:t.verbeterpunt||null})),{error:n}=await a.O.from("audit_resultaten").insert(r);if(n)throw n}catch(e){throw console.error("Add audit results error:",e),e}}async getAuditResults(e){try{let{data:t,error:r}=await a.O.from("audit_resultaten").select("*").eq("audit_id",e);if(r)return console.error("Get audit results error:",r),[];return t||[]}catch(e){return console.error("Get audit results error:",e),[]}}async deleteAudit(e){try{let{error:t}=await a.O.from("audit_resultaten").delete().eq("audit_id",e);if(t)return console.error("Delete audit results error:",t),!1;let{error:r}=await a.O.from("acties").delete().eq("audit_id",e);if(r)return console.error("Delete audit actions error:",r),!1;let{error:n}=await a.O.from("audits").delete().eq("id",e);if(n)return console.error("Delete audit error:",n),!1;return!0}catch(e){return console.error("Delete audit error:",e),!1}}async getChecklistItems(){try{let{data:e,error:t}=await a.O.from("audit_checklist_items").select("*").eq("actief",!0).order("volgorde");if(t)return console.error("Get checklist items error:",t),[];return e}catch(e){return console.error("Get checklist items error:",e),[]}}async getActions(e){try{let t=a.O.from("acties").select("\n        *,\n        audits!inner(filiaal_id),\n        audit_resultaten!inner(checklist_item_id, resultaat, opmerkingen, verbeterpunt)\n      ");(null==e?void 0:e.filiaalId)&&(t=t.eq("audits.filiaal_id",e.filiaalId)),(null==e?void 0:e.status)&&"all"!==e.status&&(t=t.eq("status",e.status)),(null==e?void 0:e.urgentie)&&"all"!==e.urgentie&&(t=t.eq("urgentie",e.urgentie));let{data:r,error:n}=await t.order("created_at",{ascending:!1});if(n)return console.error("Get actions error:",n),[];return r||[]}catch(e){return console.error("Get actions error:",e),[]}}async getActionById(e){try{let{data:t,error:r}=await a.O.from("acties").select("\n          *,\n          audits!inner(filiaal_id),\n          audit_resultaten!inner(checklist_item_id, resultaat, opmerkingen, verbeterpunt)\n        ").eq("id",e).single();if(r)return null;return t}catch(e){return console.error("Get action error:",e),null}}async updateAction(e,t){try{let{data:r,error:n}=await a.O.from("acties").update(t).eq("id",e).select().single();if(n)return null;return r}catch(e){return console.error("Update action error:",e),null}}async getAllUsers(){try{let{data:e,error:t}=await a.O.from("gebruikers").select("*").order("naam");if(t)return console.error("Get all users error:",t),[];return e}catch(e){return console.error("Get all users error:",e),[]}}async createUser(e){try{console.log("Supabase createUser called with:",e);let{data:t,error:r}=await a.O.from("gebruikers").insert({user_id:null,naam:e.naam,rol:e.rol,telefoon:e.telefoon,actief:!0}).select().single();if(r)throw console.error("Supabase createUser error:",r),Error("Database error: ".concat(r.message));return console.log("Supabase createUser success:",t),t}catch(e){throw console.error("Create user error:",e),e}}async deleteUser(e){try{let{error:t}=await a.O.from("gebruikers").delete().eq("id",e);return!t}catch(e){return console.error("Delete user error:",e),!1}}async updateUser(e,t){try{let{data:r,error:n}=await a.O.from("gebruikers").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)return console.error("Update user error:",n),null;return r}catch(e){return console.error("Update user error:",e),null}}async getUserByEmail(e){try{console.log("\uD83D\uDD0D Supabase getUserByEmail called with email:",e);let{data:t,error:r}=await a.O.from("gebruikers").select("*").eq("user_id",e).single();if(console.log("\uD83D\uDD0D Supabase getUserByEmail result:",{data:t,error:r}),r)return console.log("❌ Supabase getUserByEmail error:",r),null;return t}catch(e){return console.error("❌ Get user by email error:",e),null}}async getKPIData(e){try{let t=a.O.from("audits").select("id, score, status, audit_datum");e&&(t=t.eq("filiaal_id",e));let{data:r,error:n}=await t;if(n)return console.error("Get audits for KPI error:",n),this.getDefaultKPIData();let i=(null==r?void 0:r.length)||0,l=(null==r?void 0:r.filter(e=>"voltooid"===e.status))||[],s=l.length>0?l.reduce((e,t)=>e+(t.score||0),0)/l.length:0,o=l.length>0?l.filter(e=>(e.score||0)>=4).length/l.length*100:0,u=a.O.from("acties").select("id, status, urgentie");e&&(u=u.eq("filiaal_id",e));let{data:c,error:d}=await u,g=c||[];g.filter(e=>"pending"===e.status).length,g.filter(e=>"completed"===e.status).length,g.filter(e=>"critical"===e.urgentie).length;let f=[{item:"Koelkast temperatuur",frequentie:3,laatste_voorkomen:new Date().toISOString()},{item:"FIFO controle",frequentie:2,laatste_voorkomen:new Date().toISOString()}];return{totaal_audits:i,gemiddelde_score:s,pass_percentage:o,verbeterpunten:f,trends:[]}}catch(e){return console.error("Get KPI data error:",e),this.getDefaultKPIData()}}getDefaultKPIData(){return{totaal_audits:0,gemiddelde_score:0,pass_percentage:0,verbeterpunten:[],trends:[]}}async uploadFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"uploads",r=arguments.length>2?arguments[2]:void 0;try{let n=e.name.split(".").pop(),i=r||"".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2),".").concat(n),l="audit-photos/".concat(i),{error:s}=await a.O.storage.from(t).upload(l,e);if(s)throw s;let{data:{publicUrl:o}}=a.O.storage.from(t).getPublicUrl(l);return{url:o,filename:i}}catch(e){throw console.error("Upload file error:",e),e}}}let i=new n;class l{static getInstance(){return l.instance||(l.instance=new l),l.instance}async initialize(){this.isInitialized||(this.isInitialized=!0,console.log("ClientDataService initialized"))}async authenticateUser(e,t){try{let r=await i.authenticateUser(e,t);if(r)return console.log("✅ Supabase authentication successful:",r.user_id),r}catch(e){console.log("❌ Supabase auth failed:",e)}return null}async getUserById(e){try{let t=await i.getUserById(e);if(t)return t}catch(e){console.log("❌ Supabase getUserById failed:",e)}return null}async getFilialen(e){try{return await i.getFilialen(e)}catch(e){return console.log("❌ Supabase getFilialen failed:",e),[]}}async getFiliaalById(e){try{return await i.getFiliaalById(e)}catch(e){return console.log("❌ Supabase getFiliaalById failed:",e),null}}async getAudits(e){try{return await i.getAudits(e)}catch(e){return console.log("❌ Supabase getAudits failed:",e),[]}}async getAuditById(e){try{return await i.getAuditById(e)}catch(e){return console.log("❌ Supabase getAuditById failed:",e),null}}async createAudit(e){try{return await i.createAudit(e)}catch(e){throw console.log("❌ Supabase createAudit failed:",e),e}}async updateAudit(e,t){try{return await i.updateAudit(e,t)}catch(e){return console.log("❌ Supabase updateAudit failed:",e),null}}async getChecklistItems(){try{return await i.getChecklistItems()}catch(e){return console.log("❌ Supabase getChecklistItems failed:",e),[]}}async getKPIData(e){try{return await i.getKPIData(e)}catch(e){return console.log("❌ Supabase getKPIData failed:",e),{totalAudits:0,averageScore:0,passRate:0,pendingActions:0,completedActions:0,criticalActions:0}}}async getActions(e){try{return await i.getActions(e)}catch(e){return console.log("❌ Supabase getActions failed:",e),[]}}async getActionById(e){try{return await i.getActionById(e)}catch(e){return console.log("❌ Supabase getActionById failed:",e),null}}async updateAction(e,t){try{return await i.updateAction(e,t)}catch(e){return console.log("❌ Supabase updateAction failed:",e),null}}async getAllUsers(){try{return await i.getAllUsers()}catch(e){return console.log("❌ Supabase getAllUsers failed:",e),[]}}async createUser(e){try{return await i.createUser(e)}catch(e){throw console.log("❌ Supabase createUser failed:",e),e}}async deleteUser(e){try{return await i.deleteUser(e)}catch(e){return console.log("❌ Supabase deleteUser failed:",e),!1}}async updateUser(e,t){try{return await i.updateUser(e,t)}catch(e){return console.log("❌ Supabase updateUser failed:",e),null}}async getUserByEmail(e){try{return await i.getUserByEmail(e)}catch(e){return console.log("❌ Supabase getUserByEmail failed:",e),null}}async addAuditResults(e,t){try{return await i.addAuditResults(e,t)}catch(e){throw console.log("❌ Supabase addAuditResults failed:",e),e}}async getAuditResults(e){try{return await i.getAuditResults(e)}catch(e){return console.log("❌ Supabase getAuditResults failed:",e),[]}}async deleteAudit(e){try{return await i.deleteAudit(e)}catch(e){throw console.log("❌ Supabase deleteAudit failed:",e),e}}async uploadFile(e){try{return await i.uploadFile(e)}catch(e){throw console.log("❌ Supabase uploadFile failed:",e),e}}constructor(){this.isInitialized=!1,this.initialize()}}let s=l.getInstance()},2141:function(e,t,r){r.d(t,{O:function(){return a}});let a=(0,r(3887).eI)("https://kauerobifkgjvddyrkuz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImthdWVyb2JpZmtnanZkZHlya3V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNTIxODQsImV4cCI6MjA3NDcyODE4NH0.GqMYsz9byBYHw_fqmPYH53E4fyciz3MpdUtDQDhpvd8")}}]);